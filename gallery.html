<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Digital Gratitude List — ZackMoritz.cool</title>
<style>
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:#0f1115;color:#e7ecf1}
  .wrap{max-width:1100px;margin:0 auto;padding:24px 14px}
  h1{margin:0 0 6px}
  .small{color:#9aa6b2;font-size:13px}
  .controls{display:flex;gap:8px;align-items:center;margin-top:8px}
  select{background:#1a232f;color:#e7ecf1;border:1px solid #262b36;border-radius:8px;padding:6px 8px}
  .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:12px;margin-top:16px}
  .card{border:1px solid #262b36;background:#12161f;border-radius:12px;overflow:hidden;text-decoration:none;color:#e7ecf1}
  .thumb{display:block;width:100%;height:140px;object-fit:cover;background:#0b0e13}
  .label{padding:8px 10px;font-size:13px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;border-top:1px solid #262b36}
</style>
</head>
<body>
<div class="wrap">
  <h1>Digital Gratitude List</h1>
  <div class="controls">
    <label class="small" for="sortSel">Sort:</label>
    <select id="sortSel">
      <option value="new">Newest</option>
      <option value="old">Oldest</option>
      <option value="az">A–Z</option>
      <option value="za">Z–A</option>
    </select>
    <span id="status" class="small" style="margin-left:auto"></span>
  </div>
  <div id="grid" class="grid"><div class="small">Loading…</div></div>
</div>

<script>
const REPO="zackmoritz/zackmoritz-cool";
const BRANCH="main";
const FOLDER="Digital_Gratitude_List";
const FILE_OK=/\.(png|jpe?g|gif|webp|heic|heif|mp4|mov|webm|m4a|mp3)$/i;

const grid=document.getElementById('grid');
const statusEl=document.getElementById('status');
const sortSel=document.getElementById('sortSel');

function cardHTML(f){return `<a class="card" href="${f.url}" target="_blank"><img class="thumb" src="${f.thumb}" alt=""><div class="label">${f.name}</div></a>`;}

function sortFiles(files,mode){
  switch(mode){
    case 'new': return files.slice().sort((a,b)=> (b.time||0)-(a.time||0));
    case 'old': return files.slice().sort((a,b)=> (a.time||0)-(b.time||0));
    case 'az': return files.slice().sort((a,b)=> a.name.localeCompare(b.name));
    case 'za': return files.slice().sort((a,b)=> b.name.localeCompare(a.name));
    default: return files;
  }
}

async function fetchCommitTime(path){
  const url=`https://api.github.com/repos/${REPO}/commits?path=${encodeURIComponent(path)}&per_page=1&sha=${BRANCH}`;
  const r=await fetch(url);
  if(!r.ok) return 0;
  const arr=await r.json();
  return Date.parse(arr[0]?.commit?.committer?.date||0);
}

async function build(){
  const url=`https://api.github.com/repos/${REPO}/contents/${FOLDER}?ref=${BRANCH}`;
  const r=await fetch(url);
  const items=await r.json();
  let files=items.filter(it=>it.type==="file" && FILE_OK.test(it.name))
                 .map(it=>({name:it.name,url:`/${FOLDER}/${it.name}`,thumb:it.download_url}));
  statusEl.textContent="Fetching commit times…";
  for(const f of files){
    f.time=await fetchCommitTime(`${FOLDER}/${f.name}`);
  }
  statusEl.textContent="";
  render(files);
}

function render(files){
  const mode=sortSel.value;
  const sorted=sortFiles(files,mode);
  grid.innerHTML=sorted.map(cardHTML).join("");
}

build();
sortSel.onchange=()=>build();
</script>
</body>
</html>